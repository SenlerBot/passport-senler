var t=require("axios"),e=require("passport-oauth2");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=/*#__PURE__*/r(t);function o(){return o=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},o.apply(null,arguments)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function i(t,e){try{var r=t()}catch(t){return e(t)}return r&&r.then?r.then(void 0,e):r}var a="https://senler.ru/ajax/cabinet/OAuth2token";exports.SenlerStrategy=/*#__PURE__*/function(t){function e(e,r){var n;return e.groupID=e.groupID||"",(n=t.call(this,o({},e,{authorizationURL:"https://senler.ru/cabinet/OAuth2authorize",tokenURL:a}),r||function(){})||this).name="senler",n._clientSecret=void 0,n._tokenURL=void 0,n._clientID=void 0,n._groupID=void 0,n._callbackURL=void 0,n._clientSecret=e.clientSecret,n._callbackURL=e.callbackURL,n._groupID=e.groupID||"",n._tokenURL=a,n._clientID=e.clientID,n}var r,u;u=t,(r=e).prototype=Object.create(u.prototype),r.prototype.constructor=r,c(r,u);var s=e.prototype;return s.authenticate=function(e,r){try{var n,o,c=this,a=null==(n=e.query.code)?void 0:n.toString(),u=null==(o=e.query.group_id)?void 0:o.toString();if(!a)return Promise.resolve(t.prototype.authenticate.call(c,e,r));u&&(c._groupID=u);var s=i(function(){return Promise.resolve(c.getAccessToken(a)).then(function(t){c.success({accessToken:t,groupId:c._groupID||void 0})})},function(t){c.fail("Failed to exchange authorization code: "+t)});return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},s.getAccessToken=function(t){try{var e=this;return Promise.resolve(i(function(){return Promise.resolve(n.default.get(e._tokenURL,{params:{grant_type:"authorization_code",client_id:e._clientID,client_secret:e._clientSecret,redirect_uri:e._callbackURL,code:t,group_id:e._groupID}})).then(function(t){if(t.data&&t.data.access_token)return t.data.access_token;throw new Error("No access token in response")})},function(t){throw new Error("Failed to get access token: "+t)}))}catch(t){return Promise.reject(t)}},e}(e.Strategy);
//# sourceMappingURL=index.js.map
